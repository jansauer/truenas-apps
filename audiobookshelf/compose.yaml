services:
  app:
    image: ghcr.io/advplyr/audiobookshelf:2.32.1
    volumes:
      - /mnt/space/media/Audiobooks:/audiobooks
      - /mnt/applications/audiobookshelf/podcasts:/podcasts
      - /mnt/applications/audiobookshelf/config:/config
      - /mnt/applications/audiobookshelf/metadata:/metadata
      - /etc/localtime:/etc/localtime:ro
    networks:
      newt_default:
        aliases:
          - audiobookshelf
    labels:
      - pangolin.proxy-resources.audiobookshelf.name=Audiobookshelf
      - pangolin.proxy-resources.audiobookshelf.full-domain=audiobookshelf.${DOMAIN}
      - pangolin.proxy-resources.audiobookshelf.protocol=http
      - pangolin.proxy-resources.audiobookshelf.auth.sso-enabled=true
      - pangolin.proxy-resources.audiobookshelf.targets[0].method=http
      - pangolin.proxy-resources.audiobookshelf.targets[0].hostname=audiobookshelf
      - pangolin.proxy-resources.audiobookshelf.targets[0].port=80
      - pangolin.proxy-resources.audiobookshelf.targets[0].healthcheck.hostname=audiobookshelf
      - pangolin.proxy-resources.audiobookshelf.targets[0].healthcheck.port=80
      - pangolin.proxy-resources.audiobookshelf.targets[0].healthcheck.path=/healthcheck
      - pangolin.proxy-resources.audiobookshelf.rules[0].action=allow
      - pangolin.proxy-resources.audiobookshelf.rules[0].match=path
      - pangolin.proxy-resources.audiobookshelf.rules[0].value=/auth/*
      - pangolin.proxy-resources.audiobookshelf.rules[1].action=allow
      - pangolin.proxy-resources.audiobookshelf.rules[1].match=path
      - pangolin.proxy-resources.audiobookshelf.rules[1].value=/api/*
      - pangolin.proxy-resources.audiobookshelf.rules[2].action=allow
      - pangolin.proxy-resources.audiobookshelf.rules[2].match=path
      - pangolin.proxy-resources.audiobookshelf.rules[2].value=/socket.io/
      - pangolin.proxy-resources.audiobookshelf.rules[3].action=allow
      - pangolin.proxy-resources.audiobookshelf.rules[3].match=path
      - pangolin.proxy-resources.audiobookshelf.rules[3].value=/ping
      - pangolin.proxy-resources.audiobookshelf.rules[4].action=allow
      - pangolin.proxy-resources.audiobookshelf.rules[4].match=path
      - pangolin.proxy-resources.audiobookshelf.rules[4].value=/status
    restart: unless-stopped

networks:
  default:
    external: true
    name: none
  newt_default:
    external: true
